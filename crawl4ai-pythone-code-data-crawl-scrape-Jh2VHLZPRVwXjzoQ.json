{"updatedAt":"2025-12-11T10:42:02.401Z","createdAt":"2025-12-11T06:24:56.866Z","id":"Jh2VHLZPRVwXjzoQ","name":"crawl4ai-pythone-code-data-crawl-scrape","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-144,-32],"id":"1b91a031-ca65-4667-ad1f-3ea8cb4a745d","name":"When clicking ‘Execute workflow’"},{"parameters":{"jsCode":"{\n  \"name\": \"US Youth Soccer Crawler\",\n  \"nodes\": [\n    {\n      \"parameters\": {},\n      \"id\": \"1d1f5b8a-8c3e-4d9e-b5f1-2a3c4d5e6f7g\",\n      \"name\": \"Start\",\n      \"type\": \"n8n-nodes-base.start\",\n      \"typeVersion\": 1,\n      \"position\": [\n        250,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"jsonData\": \"[\\n  { \\\"url\\\": \\\"https://www.usyouthsoccer.org/\\\" },\\n  { \\\"url\\\": \\\"https://www.alsoccer.org/\\\" },\\n  { \\\"url\\\": \\\"https://www.alaskayouthsoccer.org/\\\" },\\n  { \\\"url\\\": \\\"https://www.azsoccerassociation.org/\\\" },\\n  { \\\"url\\\": \\\"https://www.arkansassoccer.org/\\\" }\\n]\"\n      },\n      \"id\": \"2e2f6c9b-9d4f-5e0f-c6g2-3b4d5e6f7g8h\",\n      \"name\": \"State URLs\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3,\n      \"position\": [\n        450,\n        300\n      ],\n      \"credentials\": {}\n    },\n    {\n      \"parameters\": {\n        \"loopList\": \"={{ $json }}\"\n      },\n      \"id\": \"3f3g7d0c-0e5g-6f1g-d7h3-4c5e6f7g8h9i\",\n      \"name\": \"Loop Over URLs\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"typeVersion\": 3,\n      \"position\": [\n        650,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"url\": \"={{ $item(0).json.url }}\",\n        \"method\": \"GET\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"User-Agent\",\n              \"value\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36\"\n            }\n          ]\n        },\n        \"options\": {\n          \"followRedirects\": true,\n          \"timeout\": 30000\n        }\n      },\n      \"id\": \"4g4h8e1d-1f6h-7g2h-e8i4-5d6f7g8h9i0j\",\n      \"name\": \"Fetch HTML\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4,\n      \"position\": [\n        850,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Get HTML from previous step\\nconst html = $json.body || $json || '';\\n\\n// HTML to text converter\\nfunction htmlToText(html) {\\n  let text = html;\\n  \\n  // Remove script and style tags\\n  text = text.replace(/<script\\\\b[^<]*(?:(?!<\\\\/script>)<[^<]*)*<\\\\/script>/gi, '');\\n  text = text.replace(/<style\\\\b[^<]*(?:(?!<\\\\/style>)<[^<]*)*<\\\\/style>/gi, '');\\n  \\n  // Convert common tags to line breaks\\n  text = text.replace(/<br\\\\s*\\\\/?>/gi, '\\\\n');\\n  text = text.replace(/<\\\\/p>/gi, '\\\\n');\\n  text = text.replace(/<\\\\/div>/gi, '\\\\n');\\n  text = text.replace(/<\\\\/li>/gi, '\\\\n');\\n  text = text.replace(/<\\\\/tr>/gi, '\\\\n');\\n  text = text.replace(/<\\\\/td>/gi, ' ');\\n  \\n  // Remove all HTML tags\\n  text = text.replace(/<[^>]+>/g, '');\\n  \\n  // Decode HTML entities\\n  text = text\\n    .replace(/&nbsp;/gi, ' ')\\n    .replace(/&amp;/gi, '&')\\n    .replace(/&lt;/gi, '<')\\n    .replace(/&gt;/gi, '>')\\n    .replace(/&quot;/gi, '\\\"')\\n    .replace(/&#39;/gi, \\\"'\\\")\\n    .replace(/&apos;/gi, \\\"'\\\");\\n  \\n  // Remove excess whitespace\\n  text = text.replace(/\\\\n\\\\s*\\\\n/g, '\\\\n');\\n  text = text.replace(/[ \\\\t]+/g, ' ');\\n  text = text.trim();\\n  \\n  return text;\\n}\\n\\nconst cleanText = htmlToText(html);\\n\\nreturn {\\n  state_url: $input.item.json.url,\\n  content: cleanText.substring(0, 80000),\\n  content_length: cleanText.length\\n};\"\n      },\n      \"id\": \"5h5i9f2e-2g7i-8h3i-f9j5-6e7g8h9i0j1k\",\n      \"name\": \"Convert HTML to Text\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        1050,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"url\": \"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent\",\n        \"method\": \"POST\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"x-goog-api-key\",\n              \"value\": \"AIzaSyB6wM830trUmIwpRbN-j-6M2C6X6Zjfgpo\"\n            }\n          ]\n        },\n        \"bodyParametersUi\": \"json\",\n        \"body\": \"={\\n  \\\"contents\\\": [\\n    {\\n      \\\"parts\\\": [\\n        {\\n          \\\"text\\\": \\\"You are an expert youth soccer data extraction specialist.\\\\n\\\\nFrom this website content for '{{ $json.state_url }}', extract ALL soccer teams, clubs, programs, coaches, and contact information.\\\\n\\\\nLook for:\\\\n- Team/Club names\\\\n- Coach names and contact info\\\\n- Phone numbers and emails\\\\n- Cities and locations\\\\n- Age groups (U10, U12, U14, U16, U18, etc.)\\\\n- Divisions or levels\\\\n\\\\nWebsite Content:\\\\n---\\\\n{{ $json.content }}\\\\n---\\\\n\\\\nReturn ONLY valid JSON with NO explanation:\\\\n{\\\\n  \\\\\\\"state\\\\\\\": \\\\\\\"{{ $json.state_url }}\\\\\\\",\\\\n  \\\\\\\"teams\\\\\\\": [\\\\n    {\\\\n      \\\\\\\"team_name\\\\\\\": \\\\\\\"Team Name\\\\\\\",\\\\n      \\\\\\\"coach_name\\\\\\\": \\\\\\\"First Last\\\\\\\",\\\\n      \\\\\\\"email\\\\\\\": \\\\\\\"email@example.com\\\\\\\",\\\\n      \\\\\\\"phone\\\\\\\": \\\\\\\"555-1234\\\\\\\",\\\\n      \\\\\\\"location\\\\\\\": \\\\\\\"City\\\\\\\",\\\\n      \\\\\\\"age_groups\\\\\\\": [\\\\\\\"U12\\\\\\\", \\\\\\\"U14\\\\\\\"],\\\\n      \\\\\\\"division\\\\\\\": \\\\\\\"Competitive\\\\\\\"\\\\n    }\\\\n  ]\\\\n}\\\\n\\\\nIf no teams found, return: {\\\\\\\"state\\\\\\\": \\\\\\\"{{ $json.state_url }}\\\\\\\", \\\\\\\"teams\\\\\\\": []}\\\"\\n        }\\n      ]\\n    }\\n  ],\\n  \\\"generationConfig\\\": {\\n    \\\"responseMimeType\\\": \\\"application/json\\\"\\n  }\\n}\"\n      },\n      \"id\": \"6i6j0g3f-3h8j-9i4j-g0k6-7f8h9i0j1k2l\",\n      \"name\": \"Call Gemini API\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4,\n      \"position\": [\n        1250,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"const response = $json.candidates?.[0]?.content?.parts?.[0]?.text;\\n\\nif (!response) {\\n  return { state: $input.item.json.state_url, teams: [] };\\n}\\n\\nlet cleaned = response.trim();\\nif (cleaned.startsWith('```')) {\\n  cleaned = cleaned.replace(/^```json?\\\\s*/, '').replace(/```\\\\s*$/, '');\\n}\\n\\ntry {\\n  return JSON.parse(cleaned);\\n} catch (e) {\\n  console.log('Parse error:', e.message);\\n  console.log('Response:', response.substring(0, 500));\\n  return { state: $input.item.json.state_url, teams: [] };\\n}\"\n      },\n      \"id\": \"7j7k1h4g-4i9k-0j5k-h1l7-8g9i0j1k2l3m\",\n      \"name\": \"Parse Gemini Response\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        1450,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"mode\": \"simple\"\n      },\n      \"id\": \"8k8l2i5h-5j0l-1k6l-i2m8-9h0i1j2k3l4n\",\n      \"name\": \"Merge Results\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"typeVersion\": 3,\n      \"position\": [\n        1650,\n        300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"const allTeams = $input.item.json;\\n\\nreturn {\\n  total_states_processed: allTeams.length,\\n  states: allTeams,\\n  timestamp: new Date().toISOString()\\n};\"\n      },\n      \"id\": \"9l9m3j6i-6k1m-2l7m-j3n9-0i1j2k3l4m5o\",\n      \"name\": \"Final Output\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        1850,\n        300\n      ]\n    }\n  ],\n  \"connections\": {\n    \"Start\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"State URLs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"State URLs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop over URLs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop over URLs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Fetch HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Fetch HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert HTML to Text\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert HTML to Text\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Call Gemini API\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Call Gemini API\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse Gemini Response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse Gemini Response\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Final Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[64,-32],"id":"6f8d2919-861b-4338-8a76-d544d830c2fb","name":"Code in JavaScript"}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"491d9e54-c62e-4e66-9799-77c1e2b3aec7","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-12-11T06:24:56.866Z","createdAt":"2025-12-11T06:24:56.866Z","role":"workflow:owner","workflowId":"Jh2VHLZPRVwXjzoQ","projectId":"tsuA2t8C154Ytetn"}],"activeVersion":null,"tags":[]}