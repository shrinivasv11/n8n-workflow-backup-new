{"updatedAt":"2025-11-21T07:25:45.667Z","createdAt":"2025-11-20T06:40:48.247Z","id":"UDcV50LIVDTD4iz8","name":"Data-scraping-workflow","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-448,224],"id":"2faa385d-bde4-4f8b-a45d-d63b07f4dc36","name":"When clicking ‘Execute workflow’"},{"parameters":{"operation":"Run actor and get dataset","actorId":{"__rl":true,"value":"MpRbnNmVAoj5RC1Ma","mode":"list","cachedResultName":"Playwright Scraper (apify/playwright-scraper)","cachedResultUrl":"https://console.apify.com/actors/MpRbnNmVAoj5RC1Ma/input"},"customBody":"{\n  \"maxPagesPerCrawl\": 25,\n  \"browserLog\": false,\n  \"closeCookieModals\": false,\n  \"debugLog\": false,\n  \"downloadCss\": true,\n  \"downloadMedia\": true,\n  \"excludes\": [\n    {\n      \"glob\": \"/**/*.{png,jpg,jpeg,pdf,svg,webp}\"\n    }\n  ],\n  \"globs\": [\n    {\n      \"glob\": \"https://baseballconnected.com/**\"\n    }\n  ],\n  \"headless\": true,\n  \"ignoreCorsAndCsp\": false,\n  \"ignoreSslErrors\": false,\n  \"keepUrlFragments\": false,\n  \"launcher\": \"chromium\",\n  \"linkSelector\": \"a[href]\",\n  \"maxDepth\": 1,\n  \"proxyConfiguration\": {\n    \"useApifyProxy\": true\n  },\n  \"respectRobotsTxtFile\": true,\n  \"startUrls\": [\n    {\n      \"url\": \"https://baseballconnected.com/baseball-teams/\"\n    }\n  ],\n  \"useChrome\": false,\n  \"waitUntil\": \"networkidle\",\n  \"pageFunction\": \"async function pageFunction(context) {\\n    const { page, request, enqueueLinks, log } = context;\\n    const url = request.url;\\n    const title = await page.title();\\n    const text = await page.evaluate(() => document.body.innerText || '');\\n\\n    // safer regex creation using RegExp constructor\\n    let pseudoRegex;\\n    try {\\n        pseudoRegex = new RegExp('team\\\\\\\\b|teams\\\\\\\\b|-baseball|baseball-team', 'i');\\n    } catch (e) {\\n        pseudoRegex = /team\\\\b|teams\\\\b|-baseball|baseball-team/i;\\n    }\\n\\n    try {\\n        const anchors = await page.$$eval('a[href]', els => els.map(a => a.href));\\n        const teamLinks = Array.from(new Set(anchors.filter(h => {\\n            try { return h && h.startsWith('https://baseballconnected.com') && pseudoRegex.test(h); } catch (e) { return false; }\\n        })));\\n        if (teamLinks.length) await enqueueLinks({ urls: teamLinks, label: 'TEAM' });\\n    } catch (e) {}\\n\\n    // simplified team detection\\n    let isTeamPage = false;\\n    try {\\n        const lowUrl = (url || '').toLowerCase();\\n        if (lowUrl.includes('/team') || lowUrl.includes('-baseball') || lowUrl.includes('baseball-team')) {\\n            isTeamPage = true;\\n        } else {\\n            const el = await page.$('article, .team, .team-profile, .profile, .team-details');\\n            if (el) isTeamPage = true;\\n        }\\n    } catch (e) {}\\n\\n    const result = {\\n        \\\"Team Name\\\": null,\\n        \\\"City\\\": null,\\n        \\\"State\\\": null,\\n        \\\"Contact Name\\\": null,\\n        \\\"Email\\\": null,\\n        \\\"Phone\\\": null,\\n        \\\"Website\\\": null,\\n        \\\"Age Groups\\\": null,\\n        \\\"Facebook\\\": null,\\n        \\\"Twitter\\\": null,\\n        \\\"Instagram\\\": null,\\n        \\\"Description\\\": null,\\n        \\\"URL\\\": url,\\n        \\\"_type\\\": isTeamPage ? 'team' : 'listing',\\n        \\\"title\\\": title\\n    };\\n\\n    if (!isTeamPage) {\\n        // return normalized shape for listing pages (fields will be null)\\n        return result;\\n    }\\n\\n    // Team page extraction\\n    try { result[\\\"Team Name\\\"] = await page.$eval('h1', el => el.innerText.trim()); } catch (e) {}\\n    if (!result[\\\"Team Name\\\"]) try { result[\\\"Team Name\\\"] = await page.$eval('.team-title, .entry-title, .profile-title, .page-title', el => el.innerText.trim()); } catch (e) {}\\n\\n    try {\\n        const mailtos = await page.$$eval('a[href^=\\\"mailto:\\\"]', els => els.map(a => a.href.replace(/^mailto:/i, '').split('?')[0].trim()));\\n        if (mailtos.length) result[\\\"Email\\\"] = Array.from(new Set(mailtos)).join('; ');\\n    } catch (e) {}\\n\\n    try {\\n        const tels = await page.$$eval('a[href^=\\\"tel:\\\"]', els => els.map(a => a.href.replace(/^tel:/i, '').trim()));\\n        if (tels.length) result[\\\"Phone\\\"] = Array.from(new Set(tels)).join('; ');\\n    } catch (e) {}\\n    if (!result[\\\"Phone\\\"]) {\\n        try {\\n            const phoneMatches = (text.match(/(?:\\\\+?\\\\d{1,3}[\\\\s.-]?)?(?:\\\\(?\\\\d{2,4}\\\\)?[\\\\s.-]?)?\\\\d{3,4}[\\\\s.-]?\\\\d{3,4}/g) || []);\\n            if (phoneMatches.length) result[\\\"Phone\\\"] = Array.from(new Set(phoneMatches)).join('; ');\\n        } catch (e) {}\\n    }\\n\\n    try {\\n        const external = await page.$$eval('a[href]', els => els.map(a => a.href).filter(h => h && !h.includes('baseballconnected.com')));\\n        if (external.length) {\\n            const website = external.find(h => !/facebook|instagram|twitter|mailto|tel/i.test(h));\\n            result[\\\"Website\\\"] = website || external[0];\\n        }\\n    } catch (e) {}\\n\\n    try {\\n        const socials = await page.$$eval('a[href]', els => els.map(a => a.href));\\n        for (const s of socials) {\\n            try { if (/facebook\\\\.com/i.test(s) && !result[\\\"Facebook\\\"]) result[\\\"Facebook\\\"] = s; } catch (e) {}\\n            try { if (/twitter\\\\.com/i.test(s) && !result[\\\"Twitter\\\"]) result[\\\"Twitter\\\"] = s; } catch (e) {}\\n            try { if (/instagram\\\\.com/i.test(s) && !result[\\\"Instagram\\\"]) result[\\\"Instagram\\\"] = s; } catch (e) {}\\n        }\\n    } catch (e) {}\\n\\n    try {\\n        const contactSelectors = ['.contact-name', '.team-contact h3', '.team-contact', '.contact', '.coach-name', '.contact-person'];\\n        for (const sel of contactSelectors) {\\n            try { const v = await page.$eval(sel, el => el.innerText.trim()); if (v) { result[\\\"Contact Name\\\"] = v; break; } } catch (e) {}\\n        }\\n        if (!result[\\\"Contact Name\\\"]) {\\n            try {\\n                const m = text.match(/Contact[:\\\\s]*([A-Z][a-zA-Z'\\\\-]+(?:\\\\s+[A-Z][a-zA-Z'\\\\-]+){0,3})/i);\\n                if (m) result[\\\"Contact Name\\\"] = m[1];\\n            } catch (e) {}\\n        }\\n    } catch (e) {}\\n\\n    try {\\n        const locSelectors = ['.location', '.team-location', '.team-meta .location', '.address', '.city-state'];\\n        for (const sel of locSelectors) {\\n            try {\\n                const v = await page.$eval(sel, el => el.innerText.trim());\\n                const m = v.match(/([^,\\\\n]+)\\\\s*,\\\\s*([A-Za-z]{2,}|[A-Za-z\\\\s]+)/);\\n                if (m) { result[\\\"City\\\"] = m[1].trim(); result[\\\"State\\\"] = m[2].trim(); break; }\\n            } catch (e) {}\\n        }\\n    } catch (e) {}\\n\\n    try {\\n        const ageMatches = Array.from(new Set((text.match(/\\\\b(?:[6-9]U|1[0-8]U)\\\\b/g) || [])));\\n        if (ageMatches.length) result[\\\"Age Groups\\\"] = ageMatches.join(', ');\\n    } catch (e) {}\\n\\n    try {\\n        const descSel = ['.entry-content p', '.team-description', '.profile-description', '.content p'];\\n        for (const sel of descSel) {\\n            try { const v = await page.$eval(sel, el => el.innerText.trim()); if (v && v.length > 20) { result[\\\"Description\\\"] = v; break; } } catch (e) {}\\n        }\\n        if (!result[\\\"Description\\\"]) result[\\\"Description\\\"] = text.substring(0, 400).trim();\\n    } catch (e) {}\\n\\n    return result;\\n}\\n\",\n  \"pseudoUrls\": [],\n  \"proxyRotation\": \"RECOMMENDED\",\n  \"initialCookies\": [],\n  \"maxRequestRetries\": 3,\n  \"maxResultsPerCrawl\": 0,\n  \"maxCrawlingDepth\": 0,\n  \"maxConcurrency\": 50,\n  \"pageLoadTimeoutSecs\": 60,\n  \"pageFunctionTimeoutSecs\": 60,\n  \"maxScrollHeightPixels\": 5000,\n  \"customData\": {}\n}\n"},"type":"@apify/n8n-nodes-apify.apify","typeVersion":1,"position":[-224,224],"id":"11ebd717-ee7d-4f8e-b932-476f25e9b558","name":"Run an Actor and get dataset","credentials":{"apifyApi":{"id":"yN37yrPA1ePXOJTp","name":"Apify account"}}},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"101Y3Pl-yh7h4ArxLNh9DH-1e4IUsWKg9xskkmaPh-4I","mode":"list","cachedResultName":"Data-scraping-apify","cachedResultUrl":"https://docs.google.com/spreadsheets/d/101Y3Pl-yh7h4ArxLNh9DH-1e4IUsWKg9xskkmaPh-4I/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Sheet1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/101Y3Pl-yh7h4ArxLNh9DH-1e4IUsWKg9xskkmaPh-4I/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Team Name":"={{ $json[\"Team Name\"] }}","City":"={{ $json.City }}","State":"={{ $json.State }}","Contact Name":"={{ $json[\"Contact Name\"] }}","Email":"={{ $json.Email }}","Phone":"={{ $json.Phone }}","Website":"={{ $json.Website }}","Age Groups":"={{ $json[\"Age Groups\"] }}","Facebook":"={{ $json.Facebook }}","Twitter":"={{ $json.Twitter }}","Instagram":"={{ $json.Instagram }}","Description":"={{ $json.Description }}","URL":"={{ $json.URL }}"},"matchingColumns":[],"schema":[{"id":"Team Name","displayName":"Team Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"City","displayName":"City","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"State","displayName":"State","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Contact Name","displayName":"Contact Name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email","displayName":"Email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Phone","displayName":"Phone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Website","displayName":"Website","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Age Groups","displayName":"Age Groups","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Facebook","displayName":"Facebook","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Twitter","displayName":"Twitter","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Instagram","displayName":"Instagram","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Description","displayName":"Description","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"URL","displayName":"URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.7,"position":[48,224],"id":"2430ed41-8d53-4af1-96fa-d5daea5c1fe5","name":"Append or update row in sheet","credentials":{"googleSheetsOAuth2Api":{"id":"Rb8zubR3AtNAnBYU","name":"Google Sheets account 3"}}}],"connections":{"When clicking ‘Execute workflow’":{"main":[[{"node":"Run an Actor and get dataset","type":"main","index":0}]]},"Run an Actor and get dataset":{"main":[[{"node":"Append or update row in sheet","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"63fe11d6-795f-4743-992b-0f0bd734a332","triggerCount":0,"shared":[{"updatedAt":"2025-11-20T06:40:48.247Z","createdAt":"2025-11-20T06:40:48.247Z","role":"workflow:owner","workflowId":"UDcV50LIVDTD4iz8","projectId":"tsuA2t8C154Ytetn"}],"tags":[]}